main:
  params: [args]
  steps:
   - workflow:
         try:
             steps:
                 
               - Level_1:
                   parallel:
                       branches:
                           
                           - Level_1_Thread_1:
                               steps:
                                   
                                    - J01_etl_step_1_Group:
                                       steps:
                                          - J01_etl_step_1:
                                              call: http.post
                                              args:
                                                  url: "https://us-central1-dp-111-orc.cloudfunctions.net/async-function"
                                                  auth:
                                                      type: OIDC
                                                  headers:
                                                      Content-Type: "application/json"
                                                  body:
                                                      call_type: "get_id"
                                                      workflow_name: "${args.workflow_name}"
                                                      execution_id: "${args.execution_id}"
                                                      job_name: "J01_etl_step_1"
                                              result: async_job_id
                                              next: "J01_etl_step_1_Wait"
                                          - J01_etl_step_1_Wait:
                                              call: "sys.sleep"
                                              args:
                                                  seconds: 20
                                              next: "J01_etl_step_1_Status"
                                          - J01_etl_step_1_Status:
                                              call: http.post
                                              args:
                                                  url: "https://us-central1-dp-111-orc.cloudfunctions.net/async-function"
                                                  auth:
                                                      type: OIDC
                                                  headers:
                                                      Content-Type: "application/json"
                                                  body:
                                                      call_type: "get_status"
                                                      async_job_id: ${async_job_id.body}
                                                      workflow_name: "${args.workflow_name}"
                                                      execution_id: "${args.execution_id}"
                                                      job_name: "J01_etl_step_1"
                                              result: job_status
                                              next: "J01_etl_step_1_EvaluateStatus"
                                          - J01_etl_step_1_EvaluateStatus:
                                              switch:
                                                - condition: ${job_status.body == "success"}
                                                  next: "J02_etl_step_2"
                                                - condition: false
                                                  next: "J01_etl_step_1_Wait"

                                    - J02_etl_step_2_Group:
                                       steps:
                                          - J02_etl_step_2:
                                              call: http.post
                                              args:
                                                  url: "https://us-central1-dp-111-orc.cloudfunctions.net/async-function"
                                                  auth:
                                                      type: OIDC
                                                  headers:
                                                      Content-Type: "application/json"
                                                  body:
                                                      call_type: "get_id"
                                                      workflow_name: "${args.workflow_name}"
                                                      execution_id: "${args.execution_id}"
                                                      job_name: "J02_etl_step_2"
                                              result: async_job_id
                                              next: "J02_etl_step_2_Wait"
                                          - J02_etl_step_2_Wait:
                                              call: "sys.sleep"
                                              args:
                                                  seconds: 20
                                              next: "J02_etl_step_2_Status"
                                          - J02_etl_step_2_Status:
                                              call: http.post
                                              args:
                                                  url: "https://us-central1-dp-111-orc.cloudfunctions.net/async-function"
                                                  auth:
                                                      type: OIDC
                                                  headers:
                                                      Content-Type: "application/json"
                                                  body:
                                                      call_type: "get_status"
                                                      async_job_id: ${async_job_id.body}
                                                      workflow_name: "${args.workflow_name}"
                                                      execution_id: "${args.execution_id}"
                                                      job_name: "J02_etl_step_2"
                                              result: job_status
                                              next: "J02_etl_step_2_EvaluateStatus"
                                          - J02_etl_step_2_EvaluateStatus:
                                              switch:
                                                - condition: ${job_status.body == "success"}
                                                  next: "J03_etl_step_3"
                                                - condition: false
                                                  next: "J02_etl_step_2_Wait"

                                    - J03_etl_step_3_Group:
                                       steps:
                                          - J03_etl_step_3:
                                              call: http.post
                                              args:
                                                  url: "https://us-central1-dp-111-orc.cloudfunctions.net/async-function"
                                                  auth:
                                                      type: OIDC
                                                  headers:
                                                      Content-Type: "application/json"
                                                  body:
                                                      call_type: "get_id"
                                                      workflow_name: "${args.workflow_name}"
                                                      execution_id: "${args.execution_id}"
                                                      job_name: "J03_etl_step_3"
                                              result: async_job_id
                                              next: "J03_etl_step_3_Wait"
                                          - J03_etl_step_3_Wait:
                                              call: "sys.sleep"
                                              args:
                                                  seconds: 20
                                              next: "J03_etl_step_3_Status"
                                          - J03_etl_step_3_Status:
                                              call: http.post
                                              args:
                                                  url: "https://us-central1-dp-111-orc.cloudfunctions.net/async-function"
                                                  auth:
                                                      type: OIDC
                                                  headers:
                                                      Content-Type: "application/json"
                                                  body:
                                                      call_type: "get_status"
                                                      async_job_id: ${async_job_id.body}
                                                      workflow_name: "${args.workflow_name}"
                                                      execution_id: "${args.execution_id}"
                                                      job_name: "J03_etl_step_3"
                                              result: job_status
                                              next: "J03_etl_step_3_EvaluateStatus"
                                          - J03_etl_step_3_EvaluateStatus:
                                              switch:
                                                - condition: ${job_status.body == "success"}
                                                  next: "continue"
                                                - condition: false
                                                  next: "J03_etl_step_3_Wait"

                           - Level_1_Thread_2:
                               steps:
                                   
                                    - J04_etl_step_1_1_Group:
                                       steps:
                                          - J04_etl_step_1_1:
                                              call: http.post
                                              args:
                                                  url: "https://us-central1-dp-111-orc.cloudfunctions.net/async-function"
                                                  auth:
                                                      type: OIDC
                                                  headers:
                                                      Content-Type: "application/json"
                                                  body:
                                                      call_type: "get_id"
                                                      workflow_name: "${args.workflow_name}"
                                                      execution_id: "${args.execution_id}"
                                                      job_name: "J04_etl_step_1_1"
                                              result: async_job_id
                                              next: "J04_etl_step_1_1_Wait"
                                          - J04_etl_step_1_1_Wait:
                                              call: "sys.sleep"
                                              args:
                                                  seconds: 20
                                              next: "J04_etl_step_1_1_Status"
                                          - J04_etl_step_1_1_Status:
                                              call: http.post
                                              args:
                                                  url: "https://us-central1-dp-111-orc.cloudfunctions.net/async-function"
                                                  auth:
                                                      type: OIDC
                                                  headers:
                                                      Content-Type: "application/json"
                                                  body:
                                                      call_type: "get_status"
                                                      async_job_id: ${async_job_id.body}
                                                      workflow_name: "${args.workflow_name}"
                                                      execution_id: "${args.execution_id}"
                                                      job_name: "J04_etl_step_1_1"
                                              result: job_status
                                              next: "J04_etl_step_1_1_EvaluateStatus"
                                          - J04_etl_step_1_1_EvaluateStatus:
                                              switch:
                                                - condition: ${job_status.body == "success"}
                                                  next: "continue"
                                                - condition: false
                                                  next: "J04_etl_step_1_1_Wait"

         except:
             as: e
             steps:
                 - log:
                     call: sys.log
                     args:
                         data: ${e}
                 - unhandled_exception:
                     raise: ${e}